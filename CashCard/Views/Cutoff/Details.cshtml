@using CashCard.Models
@model CashCard.Models.CutOff

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}

<h2>Details</h2>

<div>
    @Html.HiddenFor(p=>p.Id)
    <h4>CutOff</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            Branch
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Branch.Name)
        </dd>
        
        <dt>Start Date</dt>
        <dd>@Html.DisplayFor(p=>p.DateStart)</dd>
        <dt>End Date</dt>
        <dd>@Html.DisplayFor(p => p.DateEnd)</dd>
        <dt>
            @Html.DisplayNameFor(model => model.State)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.State)
        </dd>



        <dt>
            @Html.DisplayNameFor(model => model.PreviousBallance)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.PreviousBallance)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EndBallance)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EndBallance)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Note)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Note)
        </dd>
        <dd>
            @if (Model.State == StateCutOff.Start)
            {
                <input id="btnCutOff" type="button" value="Cut Off!" class="btn btn-danger " />
            }
        </dd>

    </dl>
</div>
<div class="row">
    <div class="col-lg-12">
        <table id="tbl" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Owner</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>State</th>
                    <th>Type</th>


                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (var a in Model.CashFlows)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(i => a.User.UserName)
                            </td>
                            <td>
                                @Html.DisplayFor(i => a.Date)
                            </td>
                            <td>
                                @Html.DisplayFor(i => a.Total)
                            </td>
                            <td>
                                @switch (a.State)
                                {
                                    case StateCashFlow.Draft:
                                        <span class="label label-default">Draft</span>
                                        break;
                                    case StateCashFlow.Final:
                                    <span class="label label-primary">Final</span>
                                        break;
                                    case StateCashFlow.Revision:
                                    <span class="label label-warning">Revision</span>
                                        break;
                                    case StateCashFlow.Approve:
                                    <span class="label label-success">Approve</span>
                                        break;
                                    case StateCashFlow.Reject:
                                    <span class="label label-danger">Reject</span>
                                        break;
                                }

                            </td>

                            <td>

                                @if (a is CashOutRegular)
                                {
                                    <span>Regular</span>

                                }
                                else if (a is CashIn)
                                {
                                    <span>Cash In</span>

                                }
                                else
                                {
                                    <span>Irregular</span>


                                }

                            </td>


                        </tr>
                    }
                }


            </tbody>
        </table>
        </div>

    </div>
<p>
   
    @Html.ActionLink("Back to List", "Index")
</p>


<div id="errorInfo" title="Error Info">

</div>
@section Scripts {
    @Scripts.Render("~/bundle/datatable")
    <script type="text/javascript">

        var tbl = $("#tbl").DataTable(
        {
            "searching": true,
            "lengthChange": false
        });

        var dialog = $("#errorInfo").dialog({
            autoOpen: false,
            modal: true,
            buttons: {
                Ok: function () {
                    $(this).dialog("close");
                }
            }
        });

        function showErrorInfo(error) {

            var str = "<p> \
                        <b>Error :</b> <span>" + error + "</span> \
                       </p>";
            $("#errorInfo").html(str);
            dialog.dialog("open");

        }
        $("#btnCutOff").click(function () {
            var id = $("#Id").val();
            $.ajax({
                url: '@Url.Action("CutOff")',
                data: JSON.stringify({Id: id}),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (result) {

                    if (result.Success == "1") {
                        window.location.href = '@Url.Action("index")';
                    } else {
                        showErrorInfo(result.ex);
                    }
                }

            });
        });


    </script>
}